{"version":3,"file":"LoginOverlay.js","sources":["components/LoginOverlay.vue","../../../App/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovTGVhcm4vcHJvamVjdEZpbGUvY2F0LWxpZmUtdW5pYXBwLXdlY2hhdC9jb21wb25lbnRzL0xvZ2luT3ZlcmxheS52dWU"],"sourcesContent":["<template>\r\n  <view\r\n    v-if=\"visible\"\r\n    class=\"login-overlay\"\r\n    @tap=\"closeSheet\"\r\n    @touchmove.stop.prevent\r\n  >\r\n    <view class=\"login-overlay__backdrop\"></view>\r\n    <view class=\"login-sheet\" @tap.stop>\r\n      <view class=\"login-sheet__close\" @tap=\"closeSheet\">‚úï</view>\r\n      <view class=\"login-sheet__title\">ÁôªÂΩïË¥¶Âè∑</view>\r\n      <view class=\"login-sheet__subtitle\">‰∏∫ÊúâÊïà‰øùÂ≠òÊÇ®ÁöÑÊï∞ÊçÆÔºåÂª∫ËÆÆÊÇ®ÁôªÂΩï</view>\r\n      <button\r\n        class=\"login-sheet__btn login-sheet__btn--wechat\"\r\n        :loading=\"isSubmitting\"\r\n        :disabled=\"isSubmitting\"\r\n        @tap=\"handleWeChatLogin\"\r\n      >\r\n        ÂæÆ‰ø°‰∏ÄÈîÆÁôªÂΩï\r\n      </button>\r\n      <view class=\"login-sheet__agreement\" @tap=\"toggleAgreement\">\r\n        <view class=\"checkbox\" :class=\"{ 'checkbox--checked': hasAgreed }\">\r\n          <text v-if=\"hasAgreed\">‚úì</text>\r\n        </view>\r\n        <view class=\"agreement-text\">\r\n          ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè\r\n          <text class=\"agreement-link\" @tap.stop=\"openAgreement('user')\">Áà±ËΩ¶Ê≤πËÄóÂä©ÊâãÁî®Êà∑‰ΩøÁî®ÂçèËÆÆ</text>\r\n          Âíå\r\n          <text class=\"agreement-link\" @tap.stop=\"openAgreement('privacy')\">ÈöêÁßÅ‰øùÊä§ÂçèËÆÆ</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch } from 'vue'\r\nimport { useAuth } from '@/utils/auth'\r\n\r\nconst props = defineProps<{\r\n  visible: boolean\r\n}>()\r\n\r\nconst emit = defineEmits<{\r\n  (e: 'update:visible', value: boolean): void\r\n  // Â∏¶‰∏äÁôªÂΩïÁªìÊûú\r\n  (e: 'login-success', payload: { token: string; user: Record<string, any> }): void\r\n}>()\r\n\r\nconst hasAgreed = ref(false)\r\nconst isSubmitting = ref(false)\r\nconst { refreshLoginState } = useAuth()\r\n\r\nwatch(\r\n  () => props.visible,\r\n  (visible) => {\r\n    if (!visible) {\r\n      hasAgreed.value = false\r\n      isSubmitting.value = false\r\n    }\r\n  }\r\n)\r\n\r\nconst closeSheet = () => {\r\n  emit('update:visible', false)\r\n}\r\n\r\nconst toggleAgreement = () => {\r\n  hasAgreed.value = !hasAgreed.value\r\n}\r\n\r\nconst openAgreement = (type: 'user' | 'privacy') => {\r\n  const name = type === 'user' ? 'Áî®Êà∑‰ΩøÁî®ÂçèËÆÆ' : 'ÈöêÁßÅ‰øùÊä§ÂçèËÆÆ'\r\n  uni.showToast({\r\n    title: `${name}ÊöÇÊú™‰∏äÁ∫ø`,\r\n    icon: 'none'\r\n  })\r\n}\r\n\r\nconst handleWeChatLogin = () => {\r\n  if (isSubmitting.value) return\r\n\r\n  if (!hasAgreed.value) {\r\n    uni.showToast({\r\n      title: 'ËØ∑ÂãæÈÄâÂçèËÆÆÂêéÂÜçÁôªÂΩï',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  isSubmitting.value = true\r\n\r\n  // üëá ËøôÈáåÊòØÊåâÈíÆ @tap ÁöÑÂêåÊ≠•ÂõûË∞É ‚Üí ÂèØ‰ª•Ê≠£Â∏∏Ë∞ÉÁî® getUserProfile\r\n  uni.getUserProfile({\r\n    desc: 'Áî®‰∫éÂÆåÂñÑ‰∏™‰∫∫‰ø°ÊÅØ',\r\n    success: (profileRes) => {\r\n      const userInfo = profileRes.userInfo\r\n      uni.__f__('log','at components/LoginOverlay.vue:98',98, 'getUserProfile userInfo = ', userInfo)\r\n\r\n      uni.login({\r\n        provider: 'weixin',\r\n        success: (loginRes) => {\r\n          const code = loginRes.code\r\n\r\n          uni.request({\r\n            url: 'http://10.48.75.101:3000/api/auth/login', // 10.48.75.101 192.168.60.58\r\n            method: 'POST',\r\n            header: {\r\n              'Content-Type': 'application/json'\r\n            },\r\n            data: {\r\n              code,\r\n              userInfo   // ‚úÖ ÂíåÂêéÁ´Ø app.js Ëß£ÊûÑÂ≠óÊÆµÂØπ‰∏ä      ÂâçÁ´Ø‰º† code Âíå userInfo\r\n            },\r\n            success: (res) => {\r\n              uni.__f__('log','at components/LoginOverlay.vue:116',116, 'login success res = ', res)\r\n              isSubmitting.value = false\r\n\r\n              if (res.statusCode !== 200) {\r\n                uni.showToast({ title: 'ÁôªÂΩïÂ§±Ë¥•', icon: 'none' })\r\n                return\r\n              }\r\n\r\n              const { token, user } = res.data as {\r\n                token?: string\r\n                user?: Record<string, any>\r\n              }\r\n\r\n              if (!token || !user) {\r\n                uni.showToast({ title: 'ÁôªÂΩïÊï∞ÊçÆÂºÇÂ∏∏', icon: 'none' })\r\n                return\r\n              }\r\n\r\n              // ËøôÈáåÂèØ‰ª•È°∫ÊâãÂ≠ò‰∏Ä‰ªΩ raw Êï∞ÊçÆÔºàÂèØÈÄâÔºâ\r\n              uni.setStorageSync('token', token)\r\n              uni.setStorageSync('userProfile', user)  // ‚úÖ Áªü‰∏ÄÁî® userProfile\r\n\r\n              refreshLoginState()\r\n              uni.showToast({ title: 'ÁôªÂΩïÊàêÂäü', icon: 'success' })\r\n\r\n              // ÊääÁªìÊûúÊäõÁªôÁà∂ÁªÑ‰ª∂ÔºåËÆ©Áà∂ÁªÑ‰ª∂ÂÜ≥ÂÆöÊÄé‰πàÂ±ïÁ§∫ profile\r\n              emit('login-success', { token, user })\r\n\r\n              emit('update:visible', false)\r\n            },\r\n            fail: () => {\r\n              isSubmitting.value = false\r\n              uni.showToast({ title: 'ÁΩëÁªúÈîôËØØ', icon: 'none' })\r\n            }\r\n          })\r\n        },\r\n        fail: () => {\r\n          isSubmitting.value = false\r\n          uni.showToast({ title: 'ÂæÆ‰ø°ÁôªÂΩïÂ§±Ë¥•', icon: 'none' })\r\n        }\r\n      })\r\n    },\r\n    fail: (err) => {\r\n      isSubmitting.value = false\r\n      uni.__f__('log','at components/LoginOverlay.vue:160','getUserProfile fail', err)\r\n      uni.showToast({ title: 'ÈúÄË¶ÅÊéàÊùÉÂ§¥ÂÉè‰ø°ÊÅØ', icon: 'none' })\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-overlay {\r\n  position: fixed;\r\n  inset: 0;\r\n  z-index: 1000;\r\n  display: flex;\r\n  align-items: flex-end;\r\n  justify-content: center;\r\n}\r\n\r\n.login-overlay__backdrop {\r\n  position: absolute;\r\n  inset: 0;\r\n  background: rgba(14, 21, 37, 0.55);\r\n  backdrop-filter: blur(6px);\r\n}\r\n\r\n.login-sheet {\r\n  position: relative;\r\n  width: 100%;\r\n  border-top-left-radius: 40rpx;\r\n  border-top-right-radius: 40rpx;\r\n  background: #fff;\r\n  padding: 48rpx 40rpx calc(48rpx + env(safe-area-inset-bottom, 0));\r\n  box-shadow: 0 -20rpx 40rpx rgba(7, 18, 38, 0.15);\r\n  animation: slideUp 0.3s ease-out;\r\n}\r\n\r\n.login-sheet__close {\r\n  position: absolute;\r\n  right: 36rpx;\r\n  top: 32rpx;\r\n  width: 64rpx;\r\n  height: 64rpx;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: rgba(20, 32, 58, 0.04);\r\n  font-size: 32rpx;\r\n  color: #5f6c7b;\r\n}\r\n\r\n.login-sheet__title {\r\n  font-size: 36rpx;\r\n  font-weight: 700;\r\n  color: #121d2c;\r\n}\r\n\r\n.login-sheet__subtitle {\r\n  margin-top: 12rpx;\r\n  font-size: 26rpx;\r\n  color: #6c778a;\r\n}\r\n\r\n.login-sheet__btn {\r\n  margin-top: 40rpx;\r\n  width: 100%;\r\n  height: 96rpx;\r\n  line-height: 96rpx;\r\n  border-radius: 999rpx;\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #fff;\r\n  border: none;\r\n}\r\n\r\n.login-sheet__btn--wechat {\r\n  background: linear-gradient(110deg, #2dd881, #13a853);\r\n  box-shadow: 0 24rpx 36rpx rgba(19, 168, 83, 0.35);\r\n}\r\n\r\n.login-sheet__agreement {\r\n  margin-top: 32rpx;\r\n  display: flex;\r\n  gap: 16rpx;\r\n  align-items: center;\r\n}\r\n\r\n.checkbox {\r\n  width: 32rpx;\r\n  height: 32rpx;\r\n  border: 2rpx solid rgba(20, 32, 58, 0.2);\r\n  border-radius: 8rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #fff;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.checkbox--checked {\r\n  background: #1ec15f;\r\n  border-color: #1ec15f;\r\n}\r\n\r\n.agreement-text {\r\n  flex: 1;\r\n  font-size: 24rpx;\r\n  color: #7b8697;\r\n  line-height: 1.5;\r\n}\r\n\r\n.agreement-link {\r\n  color: #1ec15f;\r\n}\r\n\r\n@keyframes slideUp {\r\n  0% {\r\n    transform: translateY(20%);\r\n    opacity: 0;\r\n  }\r\n  100% {\r\n    transform: translateY(0);\r\n    opacity: 1;\r\n  }\r\n}\r\n</style>\r\n","import Component from 'D:/Learn/projectFile/cat-life-uniapp-wechat/components/LoginOverlay.vue'\nwx.createComponent(Component)"],"names":["ref","useAuth","watch","uni"],"mappings":"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"}