{"version":3,"file":"LoginOverlay.js","sources":["components/LoginOverlay.vue","/Users/alan2/Downloads/zm/cat-life-uniapp-wechat/components/LoginOverlay.vue?type=component"],"sourcesContent":["<template>\n  <view\n    v-if=\"visible\"\n    class=\"login-overlay\"\n    @tap=\"closeSheet\"\n    @touchmove.stop.prevent\n  >\n    <view class=\"login-overlay__backdrop\"></view>\n    <view class=\"login-sheet\" @tap.stop>\n      <view class=\"login-sheet__close\" @tap=\"closeSheet\">‚úï</view>\n      <view class=\"login-sheet__title\">ÁôªÂΩïË¥¶Âè∑</view>\n      <view class=\"login-sheet__subtitle\">‰∏∫ÊúâÊïà‰øùÂ≠òÊÇ®ÁöÑÊï∞ÊçÆÔºåÂª∫ËÆÆÊÇ®ÁôªÂΩï</view>\n      <button\n        class=\"login-sheet__btn login-sheet__btn--wechat\"\n        :loading=\"isSubmitting\"\n        :disabled=\"isSubmitting\"\n        @tap=\"handleWeChatLogin\"\n      >\n        ÂæÆ‰ø°‰∏ÄÈîÆÁôªÂΩï\n      </button>\n      <view class=\"login-sheet__agreement\" @tap=\"toggleAgreement\">\n        <view class=\"checkbox\" :class=\"{ 'checkbox--checked': hasAgreed }\">\n          <text v-if=\"hasAgreed\">‚úì</text>\n        </view>\n        <view class=\"agreement-text\">\n          ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè\n          <text class=\"agreement-link\" @tap.stop=\"openAgreement('user')\">Áà±ËΩ¶Ê≤πËÄóÂä©ÊâãÁî®Êà∑‰ΩøÁî®ÂçèËÆÆ</text>\n          Âíå\n          <text class=\"agreement-link\" @tap.stop=\"openAgreement('privacy')\">ÈöêÁßÅ‰øùÊä§ÂçèËÆÆ</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\nimport { useAuth } from '@/utils/auth'\nimport { axios } from '@/utils/request'\n\nconst props = defineProps<{\n  visible: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'update:visible', value: boolean): void\n  // Â∏¶‰∏äÁôªÂΩïÁªìÊûú\n  (e: 'login-success', payload: { token: string; user: Record<string, any> }): void\n}>()\n\nconst hasAgreed = ref(false)\nconst isSubmitting = ref(false)\nconst { refreshLoginState } = useAuth()\n\nwatch(\n  () => props.visible,\n  (visible) => {\n    if (!visible) {\n      hasAgreed.value = false\n      isSubmitting.value = false\n    }\n  }\n)\n\nconst closeSheet = () => {\n  emit('update:visible', false)\n}\n\nconst toggleAgreement = () => {\n  hasAgreed.value = !hasAgreed.value\n}\n\nconst openAgreement = (type: 'user' | 'privacy') => {\n  const name = type === 'user' ? 'Áî®Êà∑‰ΩøÁî®ÂçèËÆÆ' : 'ÈöêÁßÅ‰øùÊä§ÂçèËÆÆ'\n  uni.showToast({\n    title: `${name}ÊöÇÊú™‰∏äÁ∫ø`,\n    icon: 'none'\n  })\n}\n\nconst handleWeChatLogin = () => {\n  if (isSubmitting.value) return\n\n  if (!hasAgreed.value) {\n    uni.showToast({\n      title: 'ËØ∑ÂãæÈÄâÂçèËÆÆÂêéÂÜçÁôªÂΩï',\n      icon: 'none'\n    })\n    return\n  }\n\n  isSubmitting.value = true\n\n  // üëá ËøôÈáåÊòØÊåâÈíÆ @tap ÁöÑÂêåÊ≠•ÂõûË∞É ‚Üí ÂèØ‰ª•Ê≠£Â∏∏Ë∞ÉÁî® getUserProfile\n  uni.getUserProfile({\n    desc: 'Áî®‰∫éÂÆåÂñÑ‰∏™‰∫∫‰ø°ÊÅØ',\n    success: (profileRes) => {\n      const userInfo = profileRes.userInfo\n      uni.__f__('log','at components/LoginOverlay.vue:99',99, 'getUserProfile userInfo = ', userInfo)\n\n      uni.login({\n        provider: 'weixin',\n        success: (loginRes) => {\n          const code = loginRes.code\n\n          // Áî®Ê≥ï1\n          // axios.post<{ token?: string; user?: Record<string, any> }>(\n          //   '/api/auth/login',\n          //   { code, userInfo },\n          //   { showErrorToast: false }\n          // )\n          // .then((data) => {\n          //   // ...‰øùÊåÅÂêéÁª≠ÈÄªËæë‰∏çÂèò\n          // })\n          // .catch(...)\n          // .finally(...)\n\n          // Áî®Ê≥ï2\n          axios.request<{\n            token?: string // Áªô request ÁöÑËøîÂõûÊï∞ÊçÆÂä† TypeScript Á±ªÂûãÁ∫¶Êùü„ÄÇ // token ÊòØÂèØÈÄâÂ≠óÊÆµÔºåÂèØËÉΩÊúâÂèØËÉΩÊ≤°Êúâ\n            user?: Record<string, any> // user ‰πüÊòØÂèØÈÄâÂ≠óÊÆµÔºå‰ΩÜÂÆÉÊòØ‰∏Ä‰∏™ÂØπË±°ÔºàÈîÆÂÄºÂØπÔºâ\n          }>({\n            url: '/api/auth/login',\n            method: 'POST',\n            data: {\n              code,\n              userInfo\n            },\n            showErrorToast: false\n          })\n            .then((data) => {\n              uni.__f__('log','at components/LoginOverlay.vue:132',116, 'login success data = ', data)\n\n              const { token, user } = data || {}\n\n              if (!token || !user) {\n                uni.showToast({ title: 'ÁôªÂΩïÊï∞ÊçÆÂºÇÂ∏∏', icon: 'none' })\n                return\n              }\n\n              uni.setStorageSync('token', token)\n              uni.setStorageSync('userProfile', user)\n\n              refreshLoginState()\n              uni.showToast({ title: 'ÁôªÂΩïÊàêÂäü', icon: 'success' })\n              emit('login-success', { token, user })\n              emit('update:visible', false)\n            })\n            .catch((error) => {\n              uni.__f__('log','at components/LoginOverlay.vue:150','login request fail', error)\n              uni.showToast({ title: 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï', icon: 'none' })\n            })\n            .finally(() => {\n              isSubmitting.value = false\n            })\n        },\n        fail: () => {\n          isSubmitting.value = false\n          uni.showToast({ title: 'ÂØ∞ÓÜª‰øäÈêßËØ≤Á∂çÊæ∂Ëæ´Ëß¶', icon: 'none' })\n        }\n      })\n    },\n    fail: (err) => {\n      isSubmitting.value = false\n      uni.__f__('log','at components/LoginOverlay.vue:165','getUserProfile fail', err)\n      uni.showToast({ title: 'ÈúÄË¶ÅËé∑ÂèñÁî®Êà∑‰ø°ÊÅØÊùÉÈôê', icon: 'none' })\n    }\n  })\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.login-overlay {\n  position: fixed;\n  inset: 0;\n  z-index: 1000;\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n}\n\n.login-overlay__backdrop {\n  position: absolute;\n  inset: 0;\n  background: rgba(14, 21, 37, 0.55);\n  backdrop-filter: blur(6px);\n}\n\n.login-sheet {\n  position: relative;\n  width: 100%;\n  border-top-left-radius: 40rpx;\n  border-top-right-radius: 40rpx;\n  background: #fff;\n  padding: 48rpx 40rpx calc(48rpx + env(safe-area-inset-bottom, 0));\n  box-shadow: 0 -20rpx 40rpx rgba(7, 18, 38, 0.15);\n  animation: slideUp 0.3s ease-out;\n}\n\n.login-sheet__close {\n  position: absolute;\n  right: 36rpx;\n  top: 32rpx;\n  width: 64rpx;\n  height: 64rpx;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(20, 32, 58, 0.04);\n  font-size: 32rpx;\n  color: #5f6c7b;\n}\n\n.login-sheet__title {\n  font-size: 36rpx;\n  font-weight: 700;\n  color: #121d2c;\n}\n\n.login-sheet__subtitle {\n  margin-top: 12rpx;\n  font-size: 26rpx;\n  color: #6c778a;\n}\n\n.login-sheet__btn {\n  margin-top: 40rpx;\n  width: 100%;\n  height: 96rpx;\n  line-height: 96rpx;\n  border-radius: 999rpx;\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #fff;\n  border: none;\n}\n\n.login-sheet__btn--wechat {\n  background: linear-gradient(110deg, #2dd881, #13a853);\n  box-shadow: 0 24rpx 36rpx rgba(19, 168, 83, 0.35);\n}\n\n.login-sheet__agreement {\n  margin-top: 32rpx;\n  display: flex;\n  gap: 16rpx;\n  align-items: center;\n}\n\n.checkbox {\n  width: 32rpx;\n  height: 32rpx;\n  border: 2rpx solid rgba(20, 32, 58, 0.2);\n  border-radius: 8rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  font-size: 24rpx;\n}\n\n.checkbox--checked {\n  background: #1ec15f;\n  border-color: #1ec15f;\n}\n\n.agreement-text {\n  flex: 1;\n  font-size: 24rpx;\n  color: #7b8697;\n  line-height: 1.5;\n}\n\n.agreement-link {\n  color: #1ec15f;\n}\n\n@keyframes slideUp {\n  0% {\n    transform: translateY(20%);\n    opacity: 0;\n  }\n  100% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n</style>\n","import Component from '/Users/alan2/Downloads/zm/cat-life-uniapp-wechat/components/LoginOverlay.vue'\nwx.createComponent(Component)"],"names":["ref","useAuth","watch","uni","axios"],"mappings":";;;;;;;;;;;AAwCA,UAAM,QAAQ;AAId,UAAM,OAAO;AAMP,UAAA,YAAYA,kBAAI,KAAK;AACrB,UAAA,eAAeA,kBAAI,KAAK;AACxB,UAAA,EAAE,sBAAsBC,WAAAA;AAE9BC,kBAAA;AAAA,MACE,MAAM,MAAM;AAAA,MACZ,CAAC,YAAY;AACX,YAAI,CAAC,SAAS;AACZ,oBAAU,QAAQ;AAClB,uBAAa,QAAQ;AAAA,QACvB;AAAA,MACF;AAAA,IAAA;AAGF,UAAM,aAAa,MAAM;AACvB,WAAK,kBAAkB,KAAK;AAAA,IAAA;AAG9B,UAAM,kBAAkB,MAAM;AAClB,gBAAA,QAAQ,CAAC,UAAU;AAAA,IAAA;AAGzB,UAAA,gBAAgB,CAAC,SAA6B;AAC5C,YAAA,OAAO,SAAS,SAAS,WAAW;AAC1CC,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO,GAAG,IAAI;AAAA,QACd,MAAM;AAAA,MAAA,CACP;AAAA,IAAA;AAGH,UAAM,oBAAoB,MAAM;AAC9B,UAAI,aAAa;AAAO;AAEpB,UAAA,CAAC,UAAU,OAAO;AACpBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAEA,mBAAa,QAAQ;AAGrBA,oBAAAA,MAAI,eAAe;AAAA,QACjB,MAAM;AAAA,QACN,SAAS,CAAC,eAAe;AACvB,gBAAM,WAAW,WAAW;AAC5BA,wBAAA,MAAI,MAAM,OAAM,qCAAoC,IAAI,8BAA8B,QAAQ;AAE9FA,wBAAAA,MAAI,MAAM;AAAA,YACR,UAAU;AAAA,YACV,SAAS,CAAC,aAAa;AACrB,oBAAM,OAAO,SAAS;AAetBC,4BAAAA,MAAM,QAGH;AAAA,gBACD,KAAK;AAAA,gBACL,QAAQ;AAAA,gBACR,MAAM;AAAA,kBACJ;AAAA,kBACA;AAAA,gBACF;AAAA,gBACA,gBAAgB;AAAA,cAAA,CACjB,EACE,KAAK,CAAC,SAAS;AACdD,8BAAA,MAAI,MAAM,OAAM,sCAAqC,KAAK,yBAAyB,IAAI;AAEvF,sBAAM,EAAE,OAAO,SAAS,QAAQ,CAAA;AAE5B,oBAAA,CAAC,SAAS,CAAC,MAAM;AACnBA,gCAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,gBACF;AAEIA,8BAAAA,MAAA,eAAe,SAAS,KAAK;AAC7BA,8BAAAA,MAAA,eAAe,eAAe,IAAI;AAEpB;AAClBA,8BAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChD,qBAAK,iBAAiB,EAAE,OAAO,KAAM,CAAA;AACrC,qBAAK,kBAAkB,KAAK;AAAA,cAAA,CAC7B,EACA,MAAM,CAAC,UAAU;AAChBA,8BAAA,MAAI,MAAM,OAAM,sCAAqC,sBAAsB,KAAK;AAChFA,8BAAA,MAAI,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,cAAA,CACpD,EACA,QAAQ,MAAM;AACb,6BAAa,QAAQ;AAAA,cAAA,CACtB;AAAA,YACL;AAAA,YACA,MAAM,MAAM;AACV,2BAAa,QAAQ;AACrBA,4BAAA,MAAI,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAAA,YACpD;AAAA,UAAA,CACD;AAAA,QACH;AAAA,QACA,MAAM,CAAC,QAAQ;AACb,uBAAa,QAAQ;AACrBA,wBAAA,MAAI,MAAM,OAAM,sCAAqC,uBAAuB,GAAG;AAC/EA,wBAAA,MAAI,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,QACrD;AAAA,MAAA,CACD;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACtKH,GAAG,gBAAgB,SAAS;"}