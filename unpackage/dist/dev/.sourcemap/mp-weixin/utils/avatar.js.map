{"version":3,"file":"avatar.js","sources":["utils/avatar.ts"],"sourcesContent":["// 上传头像到 Node 后端，后端再传腾讯云 COS\n\nimport { getBaseUrl } from './request'\n\nexport const uploadAvatarToCos = (filePath: string) => {\n  return new Promise((resolve, reject) => {\n    const token = uni.getStorageSync('token')\n    if (!token) {\n      uni.showToast({ title: '请先登录', icon: 'none' })\n      return reject(new Error('no token'))\n    }\n\n    uni.uploadFile({\n      url: getBaseUrl() + '/api/upload/avatar',\n      filePath,\n      name: 'file', // 要和后端 upload.single('file') 对应\n      header: {\n        Authorization: `Bearer ${token}`\n      },\n      success: (res) => {\n        try {\n          const data = JSON.parse(res.data)\n          if (data.url) {\n            resolve(data.url)        // 返回真正的 COS URL\n          } else {\n            reject(new Error('no url in response'))\n          }\n        } catch (e) {\n          reject(e)\n        }\n      },\n      fail: (err) => {\n        reject(err)\n      }\n    })\n  })\n}"],"names":["uni","getBaseUrl"],"mappings":";;;AAIa,MAAA,oBAAoB,CAAC,aAAqB;AACrD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAChC,UAAA,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,QAAI,CAAC,OAAO;AACVA,oBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C,aAAO,OAAO,IAAI,MAAM,UAAU,CAAC;AAAA,IACrC;AAEAA,kBAAAA,MAAI,WAAW;AAAA,MACb,KAAKC,6BAAe;AAAA,MACpB;AAAA,MACA,MAAM;AAAA;AAAA,MACN,QAAQ;AAAA,QACN,eAAe,UAAU,KAAK;AAAA,MAChC;AAAA,MACA,SAAS,CAAC,QAAQ;AACZ,YAAA;AACF,gBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,cAAI,KAAK,KAAK;AACZ,oBAAQ,KAAK,GAAG;AAAA,UAAA,OACX;AACE,mBAAA,IAAI,MAAM,oBAAoB,CAAC;AAAA,UACxC;AAAA,iBACO,GAAG;AACV,iBAAO,CAAC;AAAA,QACV;AAAA,MACF;AAAA,MACA,MAAM,CAAC,QAAQ;AACb,eAAO,GAAG;AAAA,MACZ;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AACH;;"}