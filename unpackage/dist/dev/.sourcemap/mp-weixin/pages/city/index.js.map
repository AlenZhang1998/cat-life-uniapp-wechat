{"version":3,"file":"index.js","sources":["pages/city/index.vue","../../../App/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2l0eS9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"city-page\">\n    <view class=\"search-wrapper\">\n      <view class=\"search-bar\">\n        <text class=\"search-icon\">üîç</text>\n        <input\n          v-model=\"keyword\"\n          class=\"search-input\"\n          placeholder=\"ÂüéÂ∏Ç/ÊãºÈü≥\"\n          placeholder-class=\"search-placeholder\"\n          confirm-type=\"search\"\n        />\n        <text\n          v-if=\"keyword\"\n          class=\"clear-icon\"\n          @tap=\"clearKeyword\"\n        >\n          ‚úï\n        </text>\n      </view>\n    </view>\n\n    <view class=\"location-card\">\n      <view>\n        <text class=\"location-label\">ÂΩìÂâç‰ΩçÁΩÆÔºö</text>\n        <text class=\"location-value\">\n          {{ locationCity || currentCity || 'Êú™ÂÆö‰Ωç' }}\n        </text>\n        <text\n          v-if=\"!locationCity\"\n          class=\"location-tip\"\n        >\n          {{ locating ? 'ÂÆö‰Ωç‰∏≠...' : 'ÁÇπÂáªÂè≥‰æßÊåâÈíÆÈáçÊñ∞ÂÆö‰Ωç' }}\n        </text>\n      </view>\n      <view class=\"location-actions\">\n        <button\n          class=\"icon-button\"\n          hover-class=\"icon-button__hover\"\n          :loading=\"locating\"\n          @tap=\"handleLocate\"\n        >\n          <text class=\"icon-text\">‚á±</text>\n        </button>\n        <button\n          class=\"icon-button\"\n          hover-class=\"icon-button__hover\"\n          @tap=\"handlePickFromMap\"\n        >\n          <text class=\"icon-text\">‚óé</text>\n        </button>\n      </view>\n    </view>\n\n    <view class=\"list-wrapper\">\n      <scroll-view\n        class=\"city-scroll\"\n        scroll-y\n        :scroll-into-view=\"activeAnchor\"\n        scroll-with-animation\n      >\n        <view\n          v-for=\"section in displayedSections\"\n          :key=\"section.letter\"\n          :id=\"`anchor-${section.letter}`\"\n          class=\"city-section\"\n        >\n          <view class=\"section-title\">\n            {{ section.letter }}\n          </view>\n          <view\n            v-for=\"city in section.items\"\n            :key=\"city.code\"\n            class=\"city-item\"\n            @tap=\"handleCityTap(city.name)\"\n          >\n            <text>{{ city.name }}</text>\n            <text\n              v-if=\"city.name === currentCity\"\n              class=\"city-tag\"\n            >\n              ÂΩìÂâç\n            </text>\n          </view>\n        </view>\n\n        <view\n          v-if=\"!displayedSections.length\"\n          class=\"empty-hint\"\n        >\n          <text>Ê≤°ÊúâÂåπÈÖçÁöÑÂüéÂ∏ÇÔºåÊç¢‰∏™ÂÖ≥ÈîÆËØçËØïËØïÔΩû</text>\n        </view>\n      </scroll-view>\n\n      <view class=\"index-bar\">\n        <text\n          v-for=\"section in allSections\"\n          :key=\"section.letter\"\n          class=\"index-letter\"\n          :class=\"{ active: section.letter === highlightedLetter }\"\n          @tap=\"jumpTo(section.letter)\"\n        >\n          {{ section.letter }}\n        </text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { onLoad } from '@dcloudio/uni-app'\nimport { computed, getCurrentInstance, ref } from 'vue'\nimport { STORAGE_KEYS } from '@/constants/storage'\nimport { CITY_LIST, CityItem } from '@/data/cities'\nimport {\n  chooseCityFromMap,\n  ensureLocationAuth,\n  locateCityByGPS\n} from '@/utils/location'\n\ntype CitySection = {\n  letter: string\n  items: CityItem[]\n}\n\nconst keyword = ref('')\nconst currentCity = ref('')\nconst locationCity = ref('')\nconst locating = ref(false)\nconst activeAnchor = ref('')\nconst highlightedLetter = ref('')\nconst eventChannel = ref<UniApp.EventChannel | null>(null)\nconst pageInstance = getCurrentInstance()\n\nconst resolveEventChannel = () => {\n  const getter =\n    pageInstance?.proxy?.getOpenerEventChannel ??\n    pageInstance?.ctx?.getOpenerEventChannel\n  return typeof getter === 'function' ? getter() : null\n}\n\nconst baseCities: CityItem[] = CITY_LIST as CityItem[]\n\nconst sortSections = (entries: CitySection[]) =>\n  entries.sort((a, b) => {\n    if (a.letter === '#') return 1\n    if (b.letter === '#') return -1\n    return a.letter.localeCompare(b.letter)\n  })\n\nconst groupCities = (cities: CityItem[]) => {\n  const map = new Map<string, CityItem[]>()\n  cities.forEach((city) => {\n    const letter = city.letter || '#'\n    if (!map.has(letter)) {\n      map.set(letter, [])\n    }\n    map.get(letter)!.push(city)\n  })\n  return sortSections(\n    Array.from(map.entries()).map(([letter, items]) => ({\n      letter,\n      items: items.sort((a, b) => a.pinyin.localeCompare(b.pinyin))\n    }))\n  )\n}\n\nconst allSections = computed(() => groupCities(baseCities))\n\nconst displayedSections = computed(() => {\n  const rawKeyword = keyword.value.trim()\n  const value = rawKeyword.toLowerCase()\n  if (!rawKeyword) {\n    return allSections.value\n  }\n\n  const filtered = baseCities.filter((city) => {\n    if (city.name.includes(rawKeyword)) return true\n    return city.pinyin.includes(value) || city.abbr.includes(value)\n  })\n  return groupCities(filtered)\n})\n\nconst clearKeyword = () => {\n  keyword.value = ''\n}\n\nconst persistCity = (cityName: string) => {\n  currentCity.value = cityName\n  uni.setStorage({\n    key: STORAGE_KEYS.selectedCity,\n    data: cityName\n  })\n}\n\nconst emitSelection = (cityName: string) => {\n  eventChannel.value?.emit('city-selected', cityName)\n}\n\nconst closePage = () => {\n  setTimeout(() => {\n    uni.navigateBack()\n  }, 150)\n}\n\nconst handleCityTap = (cityName: string) => {\n  persistCity(cityName)\n  emitSelection(cityName)\n  closePage()\n}\n\nconst handleLocate = async (applyCity = true) => {\n  if (locating.value) return\n  locating.value = true\n  try {\n    await ensureLocationAuth()\n    const located = await locateCityByGPS()\n    if (located?.city) {\n      locationCity.value = located.city\n      if (applyCity) {\n        handleCityTap(located.city)\n      }\n      return\n    }\n    if (applyCity) {\n      await handlePickFromMap()\n    }\n  } catch (error) {\n    if (applyCity) {\n      uni.showToast({\n        title: 'ËØ∑ÂÖàÂºÄÂêØÂÆö‰ΩçÊùÉÈôê',\n        icon: 'none'\n      })\n    }\n  } finally {\n    locating.value = false\n  }\n}\n\nconst handlePickFromMap = async () => {\n  const result = await chooseCityFromMap()\n  if (result?.city) {\n    locationCity.value = result.city\n    handleCityTap(result.city)\n  } else {\n    uni.showToast({\n      title: 'Êó†Ê≥ïËé∑ÂèñÂÆö‰Ωç',\n      icon: 'none'\n    })\n  }\n}\n\nconst jumpTo = (letter: string) => {\n  highlightedLetter.value = letter\n  activeAnchor.value = `anchor-${letter}`\n  setTimeout(() => {\n    activeAnchor.value = ''\n  }, 300)\n}\n\nonLoad((options) => {\n  eventChannel.value = resolveEventChannel()\n  const queryCity =\n    (options?.currentCity && decodeURIComponent(options.currentCity)) || ''\n  const storedCity =\n    (uni.getStorageSync(STORAGE_KEYS.selectedCity) as string | null) || ''\n\n  currentCity.value = queryCity || storedCity || 'Ê∑±Âú≥Â∏Ç'\n  locationCity.value = storedCity\n\n  // Ëá™Âä®ÂÆö‰Ωç‰ΩÜ‰∏çÁ´ãÂç≥ÂàáÊç¢ÂüéÂ∏ÇÔºå‰ªÖÂ±ïÁ§∫ÂÆö‰ΩçÁªìÊûú\n  setTimeout(() => {\n    handleLocate(false)\n  }, 200)\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.city-page {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f7f8fa;\n  padding-bottom: env(safe-area-inset-bottom);\n  box-sizing: border-box;\n}\n\n.search-wrapper {\n  padding: 24rpx 32rpx 8rpx;\n  background-color: #fff;\n  box-shadow: 0 8rpx 24rpx rgba(31, 39, 55, 0.08);\n}\n\n.search-bar {\n  display: flex;\n  align-items: center;\n  background-color: #f2f4f7;\n  border-radius: 999rpx;\n  padding: 0 24rpx;\n  height: 72rpx;\n\n  .search-icon {\n    font-size: 28rpx;\n    color: #8b95a1;\n    margin-right: 12rpx;\n  }\n\n  .search-input {\n    flex: 1;\n    font-size: 28rpx;\n  }\n\n  .clear-icon {\n    padding-left: 12rpx;\n    color: #c2c7d0;\n    font-size: 32rpx;\n  }\n}\n\n.location-card {\n  margin: 24rpx 32rpx;\n  padding: 24rpx 32rpx;\n  background-color: #fff;\n  border-radius: 24rpx;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n\n  .location-label {\n    font-size: 26rpx;\n    color: #8b95a1;\n  }\n\n  .location-value {\n    font-size: 34rpx;\n    font-weight: 600;\n    margin-left: 6rpx;\n    color: #222;\n  }\n\n  .location-tip {\n    display: block;\n    margin-top: 8rpx;\n    font-size: 22rpx;\n    color: #a0a7b4;\n  }\n}\n\n.location-actions {\n  display: flex;\n  gap: 16rpx;\n}\n\n.icon-button {\n  width: 72rpx;\n  height: 72rpx;\n  border-radius: 50%;\n  border: none;\n  background: #f2f4f7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n\n  &__hover {\n    background: #e1e5ea;\n  }\n\n  .icon-text {\n    font-size: 30rpx;\n    color: #1fc35f;\n  }\n}\n\n.city-scroll {\n  flex: 1;\n  padding: 0 32rpx 80rpx;\n  box-sizing: border-box;\n}\n\n.list-wrapper {\n  position: relative;\n  flex: 1;\n  display: flex;\n  padding-bottom: 32rpx;\n}\n\n.city-section {\n  margin-bottom: 32rpx;\n}\n\n.section-title {\n  font-size: 26rpx;\n  color: #8b95a1;\n  margin-bottom: 16rpx;\n}\n\n.city-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 28rpx 32rpx;\n  margin-bottom: 12rpx;\n  font-size: 30rpx;\n\n  .city-tag {\n    font-size: 24rpx;\n    color: #1fc35f;\n  }\n}\n\n.empty-hint {\n  text-align: center;\n  color: #98a0ac;\n  padding: 80rpx 0;\n  font-size: 26rpx;\n}\n\n.list-wrapper .index-bar {\n  position: absolute;\n  right: 12rpx;\n  top: 24rpx;\n  padding: 8rpx 0;\n  border-radius: 16rpx;\n  background-color: rgba(255, 255, 255, 0.9);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.index-letter {\n  font-size: 20rpx;\n  padding: 6rpx 12rpx;\n  color: #8b95a1;\n\n  &.active {\n    color: #1fc35f;\n    font-weight: 600;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/Learn/projectFile/cat-life-uniapp-wechat/pages/city/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getCurrentInstance","CITY_LIST","computed","uni","STORAGE_KEYS","ensureLocationAuth","locateCityByGPS","chooseCityFromMap","onLoad"],"mappings":"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"}