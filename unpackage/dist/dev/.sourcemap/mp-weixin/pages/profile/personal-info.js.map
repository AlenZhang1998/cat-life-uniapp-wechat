{"version":3,"file":"personal-info.js","sources":["pages/profile/personal-info.vue","pages/profile/personal-info.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"personal-info-page\">\n    <view class=\"form-card\">\n      <view class=\"avatar-section\">\n        <view class=\"avatar-preview\" @tap=\"chooseAvatar\">\n          <image v-if=\"form.avatar\" :src=\"form.avatar\" mode=\"aspectFill\" />\n          <text v-else>添加头像</text>\n        </view>\n        <text class=\"avatar-tip\">支持拍照或从本地相册选择</text>\n        <button class=\"avatar-btn\" @tap=\"chooseAvatar\">更换头像</button>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">昵称</text>\n        <input class=\"form-input\" v-model=\"form.name\" placeholder=\"请输入昵称\" maxlength=\"20\" />\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">性别</text>\n        <picker mode=\"selector\" :range=\"genderOptions\" :value=\"genderIndex\" @change=\"onGenderChange\">\n          <view class=\"picker-value\">{{ form.gender || '请选择性别' }}</view>\n        </picker>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">提车日期</text>\n        <picker mode=\"date\" :value=\"form.deliveryDate\" @change=\"onDeliveryChange\">\n          <view class=\"picker-value\">{{ form.deliveryDate || '请选择提车日期' }}</view>\n        </picker>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">爱车型号</text>\n        <input class=\"form-input\" v-model=\"form.carModel\" placeholder=\"请输入你喜欢的车型\" maxlength=\"30\" />\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">联系电话</text>\n        <input class=\"form-input\" v-model=\"form.phone\" placeholder=\"请输入手机号\" type=\"number\" maxlength=\"11\" />\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"form-label\">邮箱</text>\n        <input class=\"form-input\" v-model=\"form.email\" placeholder=\"请输入邮箱地址\" type=\"text\" />\n      </view>\n    </view>\n\n    <button class=\"save-btn\" @tap=\"handleSave\">保存</button>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { useAuth } from '@/utils/auth'\n\ninterface UserProfile {\n  avatar: string\n  name: string\n  gender: string\n  deliveryDate: string\n  carModel: string\n  phone: string\n  email: string\n}\n\nconst genderOptions = ['男', '女', '保密']\n\nconst form = ref<UserProfile>({\n  avatar: '',\n  name: '',\n  gender: '保密',\n  deliveryDate: '',\n  carModel: '',\n  phone: '',\n  email: ''\n})\n\nconst genderIndex = ref(2)\nconst { refreshLoginState } = useAuth()\n\nconst syncGenderIndex = (value: string) => {\n  const idx = genderOptions.indexOf(value)\n  genderIndex.value = idx >= 0 ? idx : 2\n}\n\nconst loadProfile = () => {\n  try {\n    const stored = uni.getStorageSync('userProfile')\n    if (stored) {\n      const profile = (typeof stored === 'string' ? JSON.parse(stored) : stored) as Partial<UserProfile> & {\n        birthDate?: string\n      }\n      if (!profile.deliveryDate && profile.birthDate) {\n        profile.deliveryDate = profile.birthDate\n      }\n      form.value = { ...form.value, ...profile }\n      syncGenderIndex(form.value.gender || '保密')\n    }\n  } catch (error) {\n    uni.__f__('warn','at pages/profile/personal-info.vue:101','加载个人信息失败', error)\n  }\n}\n\nonLoad(() => {\n  loadProfile()\n})\n\nconst onGenderChange = (event: any) => {\n  const idx = Number(event.detail.value)\n  genderIndex.value = idx\n  form.value.gender = genderOptions[idx]\n}\n\nconst onDeliveryChange = (event: any) => {\n  form.value.deliveryDate = event.detail.value\n}\n\nconst chooseAvatar = () => {\n  uni.showActionSheet({\n    itemList: ['拍照', '从相册选择'],\n    success: ({ tapIndex }) => {\n      const sourceType = tapIndex === 0 ? 'camera' : 'album'\n      pickAvatar(sourceType)\n    }\n  })\n}\n\nconst pickAvatar = (sourceType: 'camera' | 'album') => {\n  uni.chooseImage({\n    count: 1,\n    sizeType: ['compressed'],\n    sourceType: [sourceType],\n    success: (res) => {\n      form.value.avatar = res.tempFilePaths[0]\n    }\n  })\n}\n\nconst handleSave = () => {\n  if (!form.value.name || !form.value.carModel || !form.value.deliveryDate) {\n    uni.showToast({\n      title: !form.value.name ? '请填写昵称' : !form.value.carModel ? '请填写爱车型号' : '请选择提车日期',\n      icon: 'none'\n    })\n    return\n  }\n\n  try {\n    uni.setStorageSync('userProfile', { ...form.value })\n    refreshLoginState()\n    uni.showToast({\n      title: '已保存',\n      icon: 'success'\n    })\n    setTimeout(() => {\n      uni.navigateBack()\n    }, 500)\n  } catch (error) {\n    uni.showToast({\n      title: '保存失败，请稍后再试',\n      icon: 'none'\n    })\n    uni.__f__('error','at pages/profile/personal-info.vue:164','保存个人信息失败', error)\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/uni.scss';\n\n.personal-info-page {\n  min-height: 100vh;\n  background: #f5f7fb;\n  padding: 32rpx;\n  box-sizing: border-box;\n}\n\n.form-card {\n  background: #fff;\n  border-radius: 32rpx;\n  padding: 36rpx;\n  box-shadow: 0 12rpx 40rpx rgba(44, 89, 140, 0.08);\n}\n\n.avatar-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 20rpx;\n}\n\n.avatar-preview {\n  width: 160rpx;\n  height: 160rpx;\n  border-radius: 50%;\n  background: #f2f4f8;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 28rpx;\n  color: #96a0b5;\n  overflow: hidden;\n}\n\n.avatar-preview image {\n  width: 100%;\n  height: 100%;\n}\n\n.avatar-tip {\n  font-size: 24rpx;\n  color: #8b94a8;\n  margin-top: 16rpx;\n}\n\n.avatar-btn {\n  margin-top: 20rpx;\n  width: 240rpx;\n  height: 68rpx;\n  line-height: 68rpx;\n  border-radius: 999rpx;\n  background: linear-gradient(90deg, #3ed08c, #2eb872);\n  color: #fff;\n  font-size: 28rpx;\n}\n\n.form-group {\n  margin-top: 28rpx;\n}\n\n.form-label {\n  font-size: 28rpx;\n  color: #5a6276;\n  margin-bottom: 12rpx;\n  display: block;\n}\n\n.form-input,\n.picker-value {\n  width: 100%;\n  height: 80rpx;\n  border-radius: 20rpx;\n  background: #f5f7fb;\n  padding: 0 24rpx;\n  box-sizing: border-box;\n  font-size: 28rpx;\n  color: #2b3141;\n}\n\n.picker-value {\n  display: flex;\n  align-items: center;\n}\n\n.save-btn {\n  margin-top: 36rpx;\n  width: 100%;\n  height: 92rpx;\n  line-height: 92rpx;\n  border-radius: 999rpx;\n  background: linear-gradient(90deg, #28d39d, #2cb4ff);\n  color: #fff;\n  font-size: 32rpx;\n  font-weight: 600;\n}\n</style>\n","import MiniProgramPage from '/Users/alan2/Downloads/zm/cat-life-uniapp-wechat/pages/profile/personal-info.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useAuth","uni","onLoad"],"mappings":";;;;;;AAkEA,UAAM,gBAAgB,CAAC,KAAK,KAAK,IAAI;AAErC,UAAM,OAAOA,cAAAA,IAAiB;AAAA,MAC5B,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO;AAAA,MACP,OAAO;AAAA,IAAA,CACR;AAEK,UAAA,cAAcA,kBAAI,CAAC;AACnB,UAAA,EAAE,sBAAsBC,WAAAA;AAExB,UAAA,kBAAkB,CAAC,UAAkB;AACnC,YAAA,MAAM,cAAc,QAAQ,KAAK;AAC3B,kBAAA,QAAQ,OAAO,IAAI,MAAM;AAAA,IAAA;AAGvC,UAAM,cAAc,MAAM;AACpB,UAAA;AACI,cAAA,SAASC,cAAAA,MAAI,eAAe,aAAa;AAC/C,YAAI,QAAQ;AACV,gBAAM,UAAW,OAAO,WAAW,WAAW,KAAK,MAAM,MAAM,IAAI;AAGnE,cAAI,CAAC,QAAQ,gBAAgB,QAAQ,WAAW;AAC9C,oBAAQ,eAAe,QAAQ;AAAA,UACjC;AACA,eAAK,QAAQ,EAAE,GAAG,KAAK,OAAO,GAAG;AACjB,0BAAA,KAAK,MAAM,UAAU,IAAI;AAAA,QAC3C;AAAA,eACO,OAAO;AACdA,sBAAA,MAAI,MAAM,QAAO,0CAAyC,YAAY,KAAK;AAAA,MAC7E;AAAA,IAAA;AAGFC,kBAAAA,OAAO,MAAM;AACC;IAAA,CACb;AAEK,UAAA,iBAAiB,CAAC,UAAe;AACrC,YAAM,MAAM,OAAO,MAAM,OAAO,KAAK;AACrC,kBAAY,QAAQ;AACf,WAAA,MAAM,SAAS,cAAc,GAAG;AAAA,IAAA;AAGjC,UAAA,mBAAmB,CAAC,UAAe;AAClC,WAAA,MAAM,eAAe,MAAM,OAAO;AAAA,IAAA;AAGzC,UAAM,eAAe,MAAM;AACzBD,oBAAAA,MAAI,gBAAgB;AAAA,QAClB,UAAU,CAAC,MAAM,OAAO;AAAA,QACxB,SAAS,CAAC,EAAE,eAAe;AACnB,gBAAA,aAAa,aAAa,IAAI,WAAW;AAC/C,qBAAW,UAAU;AAAA,QACvB;AAAA,MAAA,CACD;AAAA,IAAA;AAGG,UAAA,aAAa,CAAC,eAAmC;AACrDA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,UAAU;AAAA,QACvB,SAAS,CAAC,QAAQ;AAChB,eAAK,MAAM,SAAS,IAAI,cAAc,CAAC;AAAA,QACzC;AAAA,MAAA,CACD;AAAA,IAAA;AAGH,UAAM,aAAa,MAAM;AACnB,UAAA,CAAC,KAAK,MAAM,QAAQ,CAAC,KAAK,MAAM,YAAY,CAAC,KAAK,MAAM,cAAc;AACxEA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,CAAC,KAAK,MAAM,OAAO,UAAU,CAAC,KAAK,MAAM,WAAW,YAAY;AAAA,UACvE,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAEI,UAAA;AACFA,sBAAA,MAAI,eAAe,eAAe,EAAE,GAAG,KAAK,OAAO;AACjC;AAClBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD,mBAAW,MAAM;AACfA,wBAAA,MAAI,aAAa;AAAA,WAChB,GAAG;AAAA,eACC,OAAO;AACdA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACDA,sBAAA,MAAI,MAAM,SAAQ,0CAAyC,YAAY,KAAK;AAAA,MAC9E;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKF,GAAG,WAAW,eAAe;"}